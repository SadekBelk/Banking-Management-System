syntax = "proto3";

package bank.account;

import "common.proto";

option java_multiple_files = true;
option java_package = "com.banking.proto.account";

service AccountService {
  rpc GetBalance(GetBalanceRequest) returns (GetBalanceResponse);

  // Step 1: Prevent double-spend
  rpc ReserveBalance(ReserveBalanceRequest) returns (ReserveBalanceResponse);

  // Step 3: Permanently deduct money
  rpc CommitReservation(CommitReservationRequest) returns (CommitReservationResponse);

  // Rollback path (timeouts, failures)
  rpc ReleaseReservation(ReleaseReservationRequest) returns (ReleaseReservationResponse);
}

message GetBalanceRequest {
  string account_id = 1; // âœ… Rule 3: IDs are strings Even if DB uses UUID/Long.
}

message GetBalanceResponse {
  bank.common.Money available_balance = 1;
}

message ReserveBalanceRequest {
  string account_id = 1;
  bank.common.Money amount = 2;

  // Idempotency key generated by payment-service (idempotency -> prevents double reservation)
  string idempotency_key = 3;
}

message ReserveBalanceResponse {
  string reservation_id = 1;
//  bool success = 1;
//  bank.common.ErrorResponse error = 2;
}

message CommitReservationRequest {
  string reservation_id = 1;
  string transaction_id = 2;
}

message CommitReservationResponse {
}

message ReleaseReservationRequest {
  string reservation_id = 1;
  string reason = 2; // optional, for audit/debug
}

message ReleaseReservationResponse {
}