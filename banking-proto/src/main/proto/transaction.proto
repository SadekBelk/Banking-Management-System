syntax = "proto3";

package bank.transaction;

import "common.proto";

option java_multiple_files = true;
option java_package = "com.banking.proto.transaction";

service TransactionService {

  // Step 2: Record intent immutably
  rpc CreateTransaction(CreateTransactionRequest) returns (CreateTransactionResponse);

  // Step 4: Mark transaction as completed
  rpc CompleteTransaction(CompleteTransactionRequest) returns (CompleteTransactionResponse);
}

enum TransactionStatus {
  TRANSACTION_STATUS_UNSPECIFIED = 0;
  PENDING = 1;
  COMPLETED = 2;
  FAILED = 3;
}

message CreateTransactionRequest {
  string from_account_id = 1;
  string to_account_id = 2;
  bank.common.Money amount = 3;

  // Correlates with Account reservation
  string reservation_id = 4;

  // Idempotency key generated by payment-service
  string idempotency_key = 5;

  string reference = 6; // optional note
}

message CreateTransactionResponse {
  string transaction_id = 1;
  TransactionStatus status = 2; // PENDING, COMPLETED, FAILED (always PENDING on create)
//  bank.common.ErrorResponse error = 3;
}

message CompleteTransactionRequest {
  string transaction_id = 1;
}

message CompleteTransactionResponse {
}