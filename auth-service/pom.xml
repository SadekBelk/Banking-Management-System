<?xml version="1.0" encoding="UTF-8"?>
<!--
╔══════════════════════════════════════════════════════════════════════════════╗
║                         AUTH SERVICE - POM.XML                                ║
║                                                                               ║
║  BUILD ORDER: STEP 1 of 12                                                    ║
║  WHY FIRST: Nothing compiles without dependencies. Maven needs to know        ║
║             what libraries to download before any code can be written.        ║
║                                                                               ║
║  WHAT THIS FILE DOES:                                                         ║
║  - Defines project metadata (groupId, artifactId, version)                    ║
║  - Specifies Java version (21)                                                ║
║  - Lists all required dependencies                                            ║
║  - Configures build plugins (compiler, Spring Boot)                           ║
║                                                                               ║
║  DEPENDENCIES EXPLAINED:                                                      ║
║  1. spring-boot-starter-web       → REST API (controllers, JSON)              ║
║  2. spring-boot-starter-security  → Spring Security framework                 ║
║  3. spring-boot-starter-data-jpa  → Database ORM (Hibernate)                  ║
║  4. spring-boot-starter-validation→ Input validation (@Valid, @NotBlank)      ║
║  5. jjwt-*                        → JWT library for token generation          ║
║  6. postgresql                    → Production database driver                ║
║  7. h2                            → Development in-memory database            ║
║  8. lombok                        → Reduces boilerplate code                  ║
║  9. springdoc-openapi             → Swagger UI documentation                  ║
║                                                                               ║
║  NEXT STEP: application.yml (configuration)                                   ║
╚══════════════════════════════════════════════════════════════════════════════╝
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <!-- 
        Parent POM: Inherits default configurations from Spring Boot
        This gives us sensible defaults for plugins, dependency versions, etc.
    -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.0</version>
        <relativePath/>
    </parent>

    <!-- 
        Project Coordinates: Unique identifier for this module
        - groupId: Organization/company identifier
        - artifactId: Project name (used in JAR filename)
        - version: Current version (1.0.0 for initial release)
    -->
    <groupId>com.bankingmanagement</groupId>
    <artifactId>auth-service</artifactId>
    <version>1.0.0</version>
    <name>auth-service</name>
    <description>Authentication Service for Digital Banking Management - JWT Authentication</description>

    <!-- 
        Properties: Centralized version management
        Define versions here, reference with ${property.name} below
        Makes upgrading libraries easier - change in one place
    -->
    <properties>
        <java.version>21</java.version>
        <!-- JWT library version - JJWT is the most popular Java JWT library -->
        <jjwt.version>0.12.6</jjwt.version>
        <!-- MapStruct for object mapping (optional, but good practice) -->
        <mapstruct.version>1.5.5.Final</mapstruct.version>
        <!-- Required for Lombok + MapStruct to work together -->
        <lombok-mapstruct-binding.version>0.2.0</lombok-mapstruct-binding.version>
        <!-- Swagger/OpenAPI for API documentation -->
        <springdoc-openapi.version>2.8.0</springdoc-openapi.version>
    </properties>

    <dependencies>
        <!-- 
        ╔══════════════════════════════════════════════════════════════════════╗
        ║                     SPRING BOOT STARTERS                              ║
        ║  Starters are "meta-dependencies" that pull in related libraries      ║
        ╚══════════════════════════════════════════════════════════════════════╝
        -->
        
        <!-- 
            WEB STARTER: Provides everything needed for REST APIs
            - Embedded Tomcat server
            - Spring MVC (@RestController, @RequestMapping)
            - Jackson for JSON serialization
            - Error handling
        -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- 
            SECURITY STARTER: Spring Security framework
            - Authentication infrastructure
            - Authorization (role-based access)
            - Password encoding (BCrypt)
            - Security filters
            
            IMPORTANT: Once added, ALL endpoints are secured by default!
            We configure which are public in SecurityConfig.java
        -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>

        <!-- 
            DATA JPA STARTER: Database access with Hibernate ORM
            - JpaRepository interface
            - Entity management (@Entity, @Table)
            - Transaction management
            - Connection pooling (HikariCP)
        -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <!-- 
            VALIDATION STARTER: Input validation
            - @Valid annotation on controller parameters
            - @NotBlank, @Email, @Size, @Pattern on DTOs
            - Automatic error response generation
        -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>

        <!-- 
            ACTUATOR STARTER: Production-ready features
            - /actuator/health endpoint for Docker health checks
            - /actuator/metrics for monitoring
            - /actuator/info for application info
        -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <!-- 
        ╔══════════════════════════════════════════════════════════════════════╗
        ║                      DATABASE DRIVERS                                 ║
        ╚══════════════════════════════════════════════════════════════════════╝
        -->
        
        <!-- 
            POSTGRESQL: Production database driver
            - Used when running in Docker or production
            - Configured in application.yml
            - scope=runtime: Not needed at compile time, only when running
        -->
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- 
            H2 DATABASE: In-memory database for local development
            - No installation required
            - Fast startup
            - Data resets on restart (perfect for development)
            - H2 Console at /h2-console for debugging
            - Configured in application-local.yml
        -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- 
        ╔══════════════════════════════════════════════════════════════════════╗
        ║                        JWT LIBRARY (JJWT)                             ║
        ║                                                                       ║
        ║  JJWT (Java JWT) is the library we use for:                          ║
        ║  - Generating JWT tokens (signing)                                    ║
        ║  - Validating JWT tokens (verification)                               ║
        ║  - Parsing JWT claims (extracting user info)                          ║
        ║                                                                       ║
        ║  Three parts required:                                                ║
        ║  1. jjwt-api    → Interfaces (compile time)                          ║
        ║  2. jjwt-impl   → Implementation (runtime)                           ║
        ║  3. jjwt-jackson→ JSON serialization (runtime)                       ║
        ╚══════════════════════════════════════════════════════════════════════╝
        -->
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-api</artifactId>
            <version>${jjwt.version}</version>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-impl</artifactId>
            <version>${jjwt.version}</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-jackson</artifactId>
            <version>${jjwt.version}</version>
            <scope>runtime</scope>
        </dependency>

        <!-- 
        ╔══════════════════════════════════════════════════════════════════════╗
        ║                      CODE GENERATION TOOLS                            ║
        ╚══════════════════════════════════════════════════════════════════════╝
        -->
        
        <!-- 
            LOMBOK: Reduces boilerplate code through annotations
            - @Getter/@Setter: Generate getters/setters
            - @Builder: Builder pattern for object creation
            - @NoArgsConstructor/@AllArgsConstructor: Constructors
            - @Slf4j: Logger instance
            - @RequiredArgsConstructor: Constructor for final fields (DI)
            
            optional=true: Not included in final JAR (compile-time only)
        -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- 
            MAPSTRUCT: Type-safe object mapping
            - Generates mapper implementations at compile time
            - Used for Entity ↔ DTO conversions (if needed)
            - More performant than reflection-based mappers
        -->
        <dependency>
            <groupId>org.mapstruct</groupId>
            <artifactId>mapstruct</artifactId>
            <version>${mapstruct.version}</version>
        </dependency>

        <!-- 
        ╔══════════════════════════════════════════════════════════════════════╗
        ║                      API DOCUMENTATION                                ║
        ╚══════════════════════════════════════════════════════════════════════╝
        -->
        
        <!-- 
            SPRINGDOC OPENAPI: Swagger UI for API documentation
            - Auto-generates API docs from controllers
            - Swagger UI at /swagger-ui.html
            - OpenAPI spec at /api-docs
            - Supports security annotations for JWT
        -->
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>${springdoc-openapi.version}</version>
        </dependency>

        <!-- 
        ╔══════════════════════════════════════════════════════════════════════╗
        ║                      TEST DEPENDENCIES                                ║
        ╚══════════════════════════════════════════════════════════════════════╝
        -->
        
        <!-- 
            TEST STARTER: JUnit 5, Mockito, Spring Test
            - @SpringBootTest for integration tests
            - MockMvc for testing controllers
            - scope=test: Only available during testing
        -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>

        <!-- 
            SECURITY TEST: Testing security configurations
            - @WithMockUser for simulating authenticated users
            - Security test utilities
        -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <!-- 
                MAVEN COMPILER PLUGIN: Configures Java compilation
                - Sets Java version
                - Enables preview features (Java 21)
                - Configures annotation processors (Lombok, MapStruct)
                
                IMPORTANT: Order of annotation processors matters!
                Lombok must run before MapStruct for proper integration.
            -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <source>${java.version}</source>
                    <target>${java.version}</target>
                    <compilerArgs>
                        <arg>--enable-preview</arg>
                    </compilerArgs>
                    <!-- 
                        Annotation Processor Order:
                        1. Lombok - generates getters/setters first
                        2. Lombok-MapStruct binding - bridges the two
                        3. MapStruct - uses Lombok-generated methods
                    -->
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                            <version>${lombok.version}</version>
                        </path>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok-mapstruct-binding</artifactId>
                            <version>${lombok-mapstruct-binding.version}</version>
                        </path>
                        <path>
                            <groupId>org.mapstruct</groupId>
                            <artifactId>mapstruct-processor</artifactId>
                            <version>${mapstruct.version}</version>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>

            <!-- 
                SPRING BOOT MAVEN PLUGIN: Builds executable JAR
                - Creates fat JAR with all dependencies
                - Enables java -jar execution
                - Excludes Lombok from final JAR
            -->
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                    <jvmArguments>--enable-preview</jvmArguments>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
