# Local Development Configuration (use with -Dspring.profiles.active=local)
server:
  port: 4004

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      server:
        webflux:
          routes:
            # Customer Service Routes (localhost)
            - id: customer-service
              uri: http://localhost:4000
              predicates:
                - Path=/api/customers/**
              filters:
                - RewritePath=/api/customers(?<segment>.*), /api/customers$\{segment}

            # Account Service Routes (localhost)
            - id: account-service
              uri: http://localhost:4001
              predicates:
                - Path=/api/accounts/**
              filters:
                - RewritePath=/api/accounts(?<segment>.*), /api/accounts$\{segment}

            # Transaction Service Routes (localhost)
            - id: transaction-service
              uri: http://localhost:4002
              predicates:
                - Path=/api/transactions/**
              filters:
                - RewritePath=/api/transactions(?<segment>.*), /api/transactions$\{segment}

            # Payment Service Routes (localhost)
            - id: payment-service
              uri: http://localhost:4003
              predicates:
                - Path=/api/payments/**
              filters:
                - RewritePath=/api/payments(?<segment>.*), /api/payments$\{segment}

            # ============================================
            # Swagger/OpenAPI Documentation Routes
            # ============================================

            # Customer Service Swagger
            - id: customer-service-swagger-ui
              uri: http://localhost:4000
              predicates:
                - Path=/customer-service/swagger-ui.html
              filters:
                - RewritePath=/customer-service/swagger-ui.html, /swagger-ui.html

            - id: customer-service-swagger-resources
              uri: http://localhost:4000
              predicates:
                - Path=/customer-service/swagger-ui/**
              filters:
                - RewritePath=/customer-service/swagger-ui(?<segment>.*), /swagger-ui$\{segment}

            - id: customer-service-api-docs
              uri: http://localhost:4000
              predicates:
                - Path=/customer-service/v3/api-docs/**
              filters:
                - RewritePath=/customer-service/v3/api-docs(?<segment>.*), /v3/api-docs$\{segment}

            # Account Service Swagger
            - id: account-service-swagger-ui
              uri: http://localhost:4001
              predicates:
                - Path=/account-service/swagger-ui.html
              filters:
                - RewritePath=/account-service/swagger-ui.html, /swagger-ui.html

            - id: account-service-swagger-resources
              uri: http://localhost:4001
              predicates:
                - Path=/account-service/swagger-ui/**
              filters:
                - RewritePath=/account-service/swagger-ui(?<segment>.*), /swagger-ui$\{segment}

            - id: account-service-api-docs
              uri: http://localhost:4001
              predicates:
                - Path=/account-service/v3/api-docs/**
              filters:
                - RewritePath=/account-service/v3/api-docs(?<segment>.*), /v3/api-docs$\{segment}

            # Transaction Service Swagger
            - id: transaction-service-swagger-ui
              uri: http://localhost:4002
              predicates:
                - Path=/transaction-service/swagger-ui.html
              filters:
                - RewritePath=/transaction-service/swagger-ui.html, /swagger-ui.html

            - id: transaction-service-swagger-resources
              uri: http://localhost:4002
              predicates:
                - Path=/transaction-service/swagger-ui/**
              filters:
                - RewritePath=/transaction-service/swagger-ui(?<segment>.*), /swagger-ui$\{segment}

            - id: transaction-service-api-docs
              uri: http://localhost:4002
              predicates:
                - Path=/transaction-service/v3/api-docs/**
              filters:
                - RewritePath=/transaction-service/v3/api-docs(?<segment>.*), /v3/api-docs$\{segment}

            # Payment Service Swagger
            - id: payment-service-swagger-ui
              uri: http://localhost:4003
              predicates:
                - Path=/payment-service/swagger-ui.html
              filters:
                - RewritePath=/payment-service/swagger-ui.html, /swagger-ui.html

            - id: payment-service-swagger-resources
              uri: http://localhost:4003
              predicates:
                - Path=/payment-service/swagger-ui/**
              filters:
                - RewritePath=/payment-service/swagger-ui(?<segment>.*), /swagger-ui$\{segment}

            - id: payment-service-api-docs
              uri: http://localhost:4003
              predicates:
                - Path=/payment-service/v3/api-docs/**
              filters:
                - RewritePath=/payment-service/v3/api-docs(?<segment>.*), /v3/api-docs$\{segment}

          globalcors:
            cors-configurations:
              '[/**]':
                allowed-origins: "*"
                allowed-methods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - OPTIONS
                allowed-headers: "*"
                max-age: 3600

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    reactor.netty.http.client: DEBUG
